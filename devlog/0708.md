# 0708

### #4.23 Followers pagination part 1

#### 1. offset pagination

- 게시판 같은 형태 (어떤 페이지로든 갈수 있다는 게 장점)
- 단점은 20만개를 skip해야한대도 어쨌든 데이터베이스는 20만개를 가져와야한다는 점
- **take/skip** : skip 만큼 게시물을 건너뛴 후부터 take만큼 보여준다

```js
// seeFollowers.resolvers.js

seeFollowers : async(_, {username, page}) => {
            const followers = await client.user
                .findUnique({where : {username}})
                .followers({
                    take:5,
                    skip:(page-1)*5
                });
            return {
                ok:true,
                followers,
            }
```

- followers 보는 방법 2가지

1. 호날두 계정에 가서 followers 를 보는 것

   - follower의 수가 많아질 경우 데이터베이스에 많은 부하

   ```js
   // seefollowers.resolvers.js
   
   seeFollowers : async(_, {username, page}) => {
               const aFollowers = await client.user
                   .findUnique({where : {username}})
                   .followers();
   }
   ```

   

2. 호날두를 팔로우 하는 사람을 찾는 것 << 권장

```js
const bFollowers = await client.user.findMany({where : {
                following : {
                    some : { // 조건 중 일부라도 맞는 항목을 찾음
                        username,
                    }
                }
}})
```



### #4.24 Followers pagination part 2

- **total pages** 가져오기

1. 아주 안 좋은 방법 보여줌
   - this code costs a lot of money

```js
// seeFollowers.resolvers.js
const totalFollowers = await client.user.findMany({
    where:{following:{some:{username}}}
});
return {
    ...
    totalPages : Math.ceil(totalFollowers.length/5)
}
```

2. 권장 방법
   - findmany 대신 count 사용

```js
const totalFollowers = await client.user.count({
                    where:{following:{some:{username}}}
                });
            return {
                totalPages: Math.ceil(totalFollowers/5),
            }
```

📌 a little optimization tip!

- user가 존재하는 지 확인할 때 user 정보를 모두 가져오는 것은 비효율적 => select로 특정필드만 가져오기

```js
const ok = await client.user.findUnique({
                where : {username},
                select : {id:true},  // 특정 필드만 불러오기
})
if (!ok){
                return {
                    ok:false,
                    error:"User not found",
                }
            }
```

### #4.25 Following pagination

