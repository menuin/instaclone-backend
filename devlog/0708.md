# 0708

### #4.23 Followers pagination part 1

#### 1. offset pagination

- ê²Œì‹œíŒ ê°™ì€ í˜•íƒœ (ì–´ë–¤ í˜ì´ì§€ë¡œë“  ê°ˆìˆ˜ ìˆë‹¤ëŠ” ê²Œ ì¥ì )
- ë‹¨ì ì€ 20ë§Œê°œë¥¼ skipí•´ì•¼í•œëŒ€ë„ ì–´ì¨Œë“  ë°ì´í„°ë² ì´ìŠ¤ëŠ” 20ë§Œê°œë¥¼ ê°€ì ¸ì™€ì•¼í•œë‹¤ëŠ” ì 
- **take/skip** : skip ë§Œí¼ ê²Œì‹œë¬¼ì„ ê±´ë„ˆë›´ í›„ë¶€í„° takeë§Œí¼ ë³´ì—¬ì¤€ë‹¤

```js
// seeFollowers.resolvers.js
// seeFollowersëŠ” publicí•˜ë‹ˆê¹Œ(ë¡œê·¸ì¸ì•ˆí•´ë„ë¨) protect ì•ˆí•´ë„ ë¨

seeFollowers : async(_, {username, page}) => {
            const followers = await client.user
                .findUnique({where : {username}})
                .followers({
                    take:5,
                    skip:(page-1)*5
                });
            return {
                ok:true,
                followers,
            }
```

- followers ë³´ëŠ” ë°©ë²• 2ê°€ì§€

1. í˜¸ë‚ ë‘ ê³„ì •ì— ê°€ì„œ followers ë¥¼ ë³´ëŠ” ê²ƒ

   - followerì˜ ìˆ˜ê°€ ë§ì•„ì§ˆ ê²½ìš° ë°ì´í„°ë² ì´ìŠ¤ì— ë§ì€ ë¶€í•˜

   ```js
   // seefollowers.resolvers.js
   
   seeFollowers : async(_, {username, page}) => {
               const aFollowers = await client.user
                   .findUnique({where : {username}})
                   .followers();
   }
   ```

   

2. í˜¸ë‚ ë‘ë¥¼ íŒ”ë¡œìš° í•˜ëŠ” ì‚¬ëŒì„ ì°¾ëŠ” ê²ƒ << ê¶Œì¥

```js
const bFollowers = await client.user.findMany({where : {
                following : {
                    some : { // ì¡°ê±´ ì¤‘ ì¼ë¶€ë¼ë„ ë§ëŠ” í•­ëª©ì„ ì°¾ìŒ
                        username,
                    }
                }
}})
```



### #4.24 Followers pagination part 2

- **total pages** ê°€ì ¸ì˜¤ê¸°

1. ì•„ì£¼ ì•ˆ ì¢‹ì€ ë°©ë²• ë³´ì—¬ì¤Œ
   - this code costs a lot of money

```js
// seeFollowers.resolvers.js
const totalFollowers = await client.user.findMany({
    where:{following:{some:{username}}}
});
return {
    ...
    totalPages : Math.ceil(totalFollowers.length/5)
}
```

2. ê¶Œì¥ ë°©ë²•
   - findmany ëŒ€ì‹  count ì‚¬ìš©

```js
const totalFollowers = await client.user.count({
                    where:{following:{some:{username}}}
                });
            return {
                totalPages: Math.ceil(totalFollowers/5),
            }
```

ğŸ“Œ a little optimization tip!

- userê°€ ì¡´ì¬í•˜ëŠ” ì§€ í™•ì¸í•  ë•Œ user ì •ë³´ë¥¼ ëª¨ë‘ ê°€ì ¸ì˜¤ëŠ” ê²ƒì€ ë¹„íš¨ìœ¨ì  => selectë¡œ íŠ¹ì •í•„ë“œë§Œ ê°€ì ¸ì˜¤ê¸°

```js
const ok = await client.user.findUnique({
                where : {username},
                select : {id:true},  // íŠ¹ì • í•„ë“œë§Œ ë¶ˆëŸ¬ì˜¤ê¸°
})
if (!ok){
                return {
                    ok:false,
                    error:"User not found",
                }
            }
```

### #4.25 Following pagination

- seeFollowing : cursor based pagination ì‚¬ìš©í• ê±°ì„

#### 2. Cursor-based pagination

- offset pagination ì´ë‘ ë‹¤ë¥´ê²Œ ìš°ë¦¬ê°€ ë§ˆì§€ë§‰ìœ¼ë¡œ ë³¸ ê²Œ ë­”ì§€ DBì— ì•Œë ¤ì¤˜ì•¼ í•œë‹¤ (EX. ë§ˆì§€ë§‰ìœ¼ë¡œ ë³¸ following listì˜ ìœ ì €)
- ì¥ì  : ë§ì€ ë°ì´í„°ì— ìš©ì´
- ë‹¨ì  : íŠ¹ì • í˜ì´ì§€ë¡œ ì´ë™í•˜ëŠ” ê²ƒì€ ì–´ë µë‹¤

```js
// seeFollowing.typeDefs.js
type Query {
        seeFollowing(username:String!, lastId:Int) : SeeFollowingResult
    } // lastIdëŠ” not "required"


// seeFollowing.resolvers.js
const following  = await client.user
                .findUnique({where : {username}})
                .following({
                    take:5,
                    skip: lastId? 1 : 0,
     // lastIdê°€ ì¡´ì¬í•˜ë©´ skip 1 (ë§ˆì§€ë§‰ìœ¼ë¡œ ë³¸ ìœ ì €ëŠ” ë‹¤ìŒí˜ì´ì§€ì—ì„œ ë³´ì—¬ì£¼ì§€ x)
                    ...(lastId && {cursor : {id : lastId}})
     // lastIdê°€ ì¡´ì¬í•˜ë©´ "cursor"ëŠ” ë§ˆì§€ë§‰ìœ¼ë¡œ ë³¸ ìœ ì €ì˜ idë¥¼ ê°€ë¦¬í‚¨ë‹¤
                });

                return {
                    ok:true,
                    following,
                }
```





