# 👻 DEVLOG 7/12

### #6.14 See photo comments

- photos.typeDefs 에 comment(numOfComments, to be exact) 추가 (type Photo) 

  `comments : Int!`

- photos.resolvers >> comments

- seePhotosComment를 comments  폴더 내에 만들지 photos 폴더 내에 만들지 >> 모델링 문제



**without pagination** - 데이터베이스에 부하

```js
// seePhotoComments.resolvers
seePhotoComments: (_, { id }) => client.photo.findUnique({
            where: {
                id,
            },
        }).Comment(),
```

**with pagination**

```js
 seePhotoComments: (_, { id }) => client.comment.findMany({
            where: {
                photoId: id,
            },
     		skip: ~
     		take : ~
            orderBy: {
                createdAt: "asc",
            }
        })
```

- 왜 굳이 seePhotoComments를 만들었는가 (seePhotoLikes도 마찬가지)

  ```js
  seePhoto { // 이렇게 확인할 수도 있음
      comments (page:1){
          id
          caption
      }
  }
  ```

  - 인스타그램에서 comment는 사진을 보여주는 페이지와 다른 페이지임(다른 페이지로 넘어감) -> 또다른 resolver가 실행되는 것으로 판단
  - 한 화면에서 보여주고 싶으면 typeDefs에 `comments : [Comment]`라고 적었을것임



### #6.15 isMine

- loggedInUser는 null인 경우가 있기 때문에(로그인안했을경우) 항상 분기를 해줘야함

```js
// photos.resolvers
isMine: ({ userId }, _, { loggedInUser }) => {
            if (!loggedInUser) {
                return false;
            }
            return userId === loggedInUser.id;
        }
```

- comments.resolvers에도 붙여넣기

### #6.16 Delete comment and photos

- deletePhoto
  1. photo가 없을 경우 > error
  2. 삭제하려는 photo의 주인(userId)이 로그인한 유저와 불일치(loggedInUser.id) > error
  3. else > delete
- deleteComment도 비슷



### #6.17 editComment

- editComment.resolvers/typeDefs  코드 확인

- 한가지 불편한점: `ok:Boolean! error:String`을 반복하고 있음

  - DeleteCommentResult나 editCommentResult 나 모든 Result의 내용물이 똑같기 때문에 하나의 mutation response를 생성

  ```js
  // shared/shared.typeDefs.js
  import { gql } from "apollo-server";
  
  export default gql`
      type MutationResponse {
          ok:Boolean!
          error : String
      }
  `
  ```

- graphql combines all types, so you don't need to import `MutationResponse`

```js
// deleteComment.typeDefs

type Mutation {
        deleteComment(id:Int!) : MutationResponse!
    }
```

